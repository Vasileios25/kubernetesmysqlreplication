apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-source-cm2
  annotations:
    use-subpath: "true"
  labels:
    io.kompose.service: mysql-source
data:
  init.sql: |
    -- Create replication user
    DROP USER IF EXISTS 'slave_user'@'%';
    CREATE USER 'slave_user'@'%' IDENTIFIED BY 'password' REQUIRE SSL;
    GRANT REPLICATION SLAVE ON *.* TO 'slave_user'@'%';
    FLUSH PRIVILEGES;

    -- Create database and table
    CREATE DATABASE IF NOT EXISTS app;
    USE app;

    CREATE TABLE IF NOT EXISTS users (
      id INT AUTO_INCREMENT PRIMARY KEY,
      username VARCHAR(50) UNIQUE NOT NULL,
      password VARCHAR(255) NOT NULL
    );
